#!/bin/sh
# shadowsocks-server service

DAEMON='/usr/local/bin/node'
OPTS='/usr/local/bin/ssserver -c /gfwbreakers/transparent/shadowsocks-server/config.json'
USER='root'

start() {
    echo "Starting shadowsocks-server..."
    if [ -x $DAEMON ]; then
        start-stop-daemon -b -o -c $USER -S -u $USER -x $DAEMON -- $OPTS
    fi
}

stop() {
    echo "Stopping shadowsocks-server..."
    if [ -x $DAEMON ]; then
        start-stop-daemon -o -c $USER -K -u $USER -x $DAEMON -- $OPTS
        sleep 3
    fi
}

status() {
    dbpid=`pgrep -u $USER node`
    if [ -z $dbpid ]; then
        echo "shadowsocks-server is not running."
    else
        echo "shadowsocks-server is running with pid $dbpid."
    fi
}

case "$1" in
    start)
        start
        ;;
    stop)
        stop
        ;;
    restart|reload|force-reload)
        stop
        start
        ;;
    status)
        status
        ;;
    *)
        echo "Usage: /etc/init.d/shadowsocks-server {start|stop|reload|force-reload|restart|status}"
        exit 1
esac

exit 0
